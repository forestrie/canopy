version: '3'

vars:
  CANOPY_DIR: './packages/apps/canopy'
  PLAYWRIGHT_DIR: './tests/e2e'

tasks:
  all:
    desc: |
      Run all tests
      Executes unit tests and e2e tests
    cmds:
      - task: unit
      - task: e2e

  unit:
    desc: |
      Run unit tests
      Executes Vitest unit tests for all packages
    cmds:
      - echo "ğŸ§ª Running unit tests..."
      - pnpm run test
      - echo "âœ… Unit tests complete!"

  unit:watch:
    desc: |
      Run unit tests in watch mode
      Continuously runs tests as files change
    cmds:
      - echo "ğŸ‘€ Starting unit test watch mode..."
      - pnpm run test:watch

  e2e:
    desc: |
      Run end-to-end tests
      Executes Playwright tests for API and UI
    deps: [e2e:install]
    cmds:
      - echo "ğŸ­ Running e2e tests..."
      - npx playwright test
      - echo "âœ… E2E tests complete!"

  e2e:install:
    desc: |
      Install Playwright browsers
      Downloads required browser binaries
    cmds:
      - echo "ğŸ“¦ Installing Playwright browsers..."
      - npx playwright install
      - echo "âœ… Playwright browsers installed!"

  e2e:ui:
    desc: |
      Run e2e tests with UI
      Opens Playwright test runner UI
    deps: [e2e:install]
    cmds:
      - echo "ğŸ­ Opening Playwright UI..."
      - npx playwright test --ui

  e2e:debug:
    desc: |
      Debug e2e tests
      Runs tests in debug mode with browser visible
    deps: [e2e:install]
    cmds:
      - echo "ğŸ› Running e2e tests in debug mode..."
      - npx playwright test --debug

  api:
    desc: |
      Test API endpoints
      Runs API-specific Playwright tests
    cmds:
      - echo "ğŸ”Œ Testing API endpoints..."
      - npx playwright test --grep @api
      - echo "âœ… API tests complete!"

  coverage:
    desc: |
      Run tests with coverage
      Generates code coverage report
    cmds:
      - echo "ğŸ“Š Running tests with coverage..."
      - pnpm run test:coverage
      - echo "âœ… Coverage report generated!"

  lint:
    desc: |
      Lint test files
      Checks test files for style and correctness
    cmds:
      - echo "ğŸ¨ Linting test files..."
      - pnpm run lint
      - echo "âœ… Test linting complete!"

  ci:
    desc: |
      Run tests in CI mode
      Executes all tests suitable for CI/CD pipeline
    cmds:
      - echo "ğŸ¤– Running CI test suite..."
      - pnpm run test:ci
      - npx playwright test --reporter=github
      - echo "âœ… CI tests complete!"