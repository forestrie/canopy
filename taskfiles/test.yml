version: '3'

vars:
  CANOPY_DIR: './packages/apps/canopy'
  PLAYWRIGHT_DIR: './tests/e2e'

tasks:
  all:
    desc: Run all unit and e2e tests
    cmds:
      - task: unit
      - task: e2e

  unit:
    desc: Run unit tests with Vitest
    cmds:
      - echo "🧪 Running unit tests..."
      - pnpm run test
      - echo "✅ Unit tests complete!"

  unit:watch:
    desc: Run unit tests in watch mode
    cmds:
      - echo "👀 Starting unit test watch mode..."
      - pnpm run test:watch

  e2e:
    desc: Run Playwright e2e tests
    deps: [e2e:install]
    cmds:
      - echo "🎭 Running e2e tests..."
      - npx playwright test
      - echo "✅ E2E tests complete!"

  e2e:install:
    desc: Install Playwright browsers
    cmds:
      - echo "📦 Installing Playwright browsers..."
      - npx playwright install
      - echo "✅ Playwright browsers installed!"

  e2e:ui:
    desc: Open Playwright test runner UI
    deps: [e2e:install]
    cmds:
      - echo "🎭 Opening Playwright UI..."
      - npx playwright test --ui

  e2e:debug:
    desc: Debug e2e tests with visible browser
    deps: [e2e:install]
    cmds:
      - echo "🐛 Running e2e tests in debug mode..."
      - npx playwright test --debug

  api:
    desc: Run API-specific tests
    cmds:
      - echo "🔌 Testing API endpoints..."
      - npx playwright test --grep @api
      - echo "✅ API tests complete!"

  coverage:
    desc: Generate test coverage report
    cmds:
      - echo "📊 Running tests with coverage..."
      - pnpm run test:coverage
      - echo "✅ Coverage report generated!"

  lint:
    desc: Lint test files
    cmds:
      - echo "🎨 Linting test files..."
      - pnpm run lint
      - echo "✅ Test linting complete!"

  ci:
    desc: Run CI test suite
    cmds:
      - echo "🤖 Running CI test suite..."
      - pnpm run test:ci
      - npx playwright test --reporter=github
      - echo "✅ CI tests complete!"