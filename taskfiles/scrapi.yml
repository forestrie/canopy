---
# curl examples that excercise the scrapi endpoints

version: "3"

vars:
  #BASE_URL: '{{.BASE_URL | default "http://localhost:8788"}}' # wrangler
  BASE_URL: '{{.BASE_URL | default "http://localhost:5173"}}' # vite
  API_KEY: "test-api-key"
  SIGN1_MSG1: '\x84\x40\xa0\x45\x48\x65\x6c\x6c\x6f\x40'

tasks:
  post-entry:
    desc: Post a CBOR-encoded SCRAPI entry to the /entries endpoint
    cmds:
      - cmd: |
          printf '{{.SIGN1_MSG1}}' \
          | curl -X POST "{{.BASE_URL}}/entries" \
          -H 'Content-Type: application/cose; cose-type="cose-sign1"' \
          -H "Authorization: Bearer {{.API_KEY}}" \
          --output post-entry.response \
          --data-binary @-
